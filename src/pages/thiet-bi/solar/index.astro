---
import Layout from "../../../layouts/Layout.astro";
import fetchApi from "../../../lib/strapi.ts";
import type Products from "../../../interfaces/products.ts";
import Image from "astro/components/Image.astro";

const Products = await fetchApi<Products[]>({
    endpoint:
        "products?populate=image&populate[1]=highlight&filters[$and][0][categories][$eq]=solar", // the content type to fetch
    wrappedByKey: "data", // the key to unwrap the response
});
---

<Layout title="Tấm quang năng">
    <div class="bg-white py-24 sm:py-12">
        <div class="mx-auto max-w-7xl px-4 lg:px-8">
            <div class="mx-auto max-w-2xl lg:mx-0">
                <h2
                    class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl"
                >
                    Tấm quang năng
                </h2>
            </div>
            <div
                class="pt-5 grid grid-cols-1 gap-y-4 sm:grid-cols-2 sm:gap-x-6 sm:gap-y-10 lg:grid-cols-3 lg:gap-x-4"
            >
                {
                    Products.map((product) => (
                        <div class="bg-white xl:px-4 xl:py-4 px-2  rounded-lg border border-gray-200 ">
                            <ul
                                role="list"
                                class="my-4 flex justify-between gap-x-2"
                            >
                                <li>
                                    <ul
                                        role="list"
                                        class=" flex justify-between gap-x-1 "
                                    >
                                        <li>
                                            {product.attributes.he && (
                                                <button
                                                    type="button"
                                                    class="inline-flex bg-green-500 text-white items-center gap-x-1.5 rounded-lg px-2.5 py-1.5 xl:text-sm text-md font-semibold shadow-sm "
                                                >
                                                    {product.attributes.he}
                                                </button>
                                            )}
                                        </li>
                                        <li>
                                            {product.attributes.pha && (
                                                <button
                                                    type="button"
                                                    class="inline-flex bg-green-500 text-white items-center gap-x-1.5 rounded-lg px-2.5 py-1.5 xl:text-sm text-md font-semibold shadow-sm "
                                                >
                                                    {product.attributes.pha}
                                                </button>
                                            )}
                                        </li>
                                    </ul>
                                </li>
                                <li />
                            </ul>
                            <ul
                                role="list"
                                class="my-4 flex justify-between gap-x-2 bg-white rounded-lg "
                            >
                                <li class="flex flex-col justify-center">
                                    <a
                                        href={`/thiet-bi/${product.attributes.slug}/`}
                                    >
                                        <Image
                                            class="rounded-lg mx-auto aspect-[972/1080] w-full "
                                            src={`https://app.slmsolar.com${product.attributes.image.data.attributes.formats.small.url}`}
                                            alt={product.attributes.title}
                                            inferSize
                                        />
                                    </a>
                                </li>
                                <li class="flex flex-col justify-center gap-2">
                                    {Array.isArray(product.attributes.highlight)
                                        ? product.attributes.highlight.map(
                                              (highlight: any) => (
                                                  <div class="flex flex-col justify-center  bg-slate-100 rounded-md px-2 py-2 shadow sm:p-2 w-20 h-16">
                                                      <div class="truncate text-sm font-medium text-gray-500 text-center">
                                                          {highlight.title}
                                                      </div>
                                                      <dd class="truncate mt-1 text-xl font-semibold tracking-tight text-center text-gray-900">
                                                          {highlight.value}
                                                      </dd>
                                                  </div>
                                              )
                                          )
                                        : null}
                                </li>
                            </ul>
                            <a href={`/thiet-bi/${product.attributes.slug}/`}>
                                <h3 class="text-xl truncate font-medium text-gray-900">
                                    {product.attributes.title}
                                </h3>
                            </a>
                            <div class=" w-full bg-red-500 px-6 my-2 rounded-md  text-center  py-1.5   ">
                                <h3 class="text-white text-2xl font-semibold ">
                                    {product.attributes.price}
                                    <sup>đ</sup>
                                </h3>
                            </div>
                        </div>
                    ))
                }
            </div>
        </div>
    </div>
</Layout>
